# CSE260 HW3 Docker
This repository contains the files necessary to build a Docker environment for the CSE260 Homework 3. The docker environment supports running `mpirun` with up to the number of processes available CPU cores on the host machine. This is intended to facilitate easy testing and development for the homework assignment. You will need to use other environments (expanse, pi-cluster) to run larger experiments.

## Setup
1. **Install Docker**: Make sure you have Docker Engine installed on your machine. If not installed, follow the instructions corresponding to your operating system:

    - **Linux**:
        For Linux, you can follow the official Docker Engine [installation guide](https://docs.docker.com/engine/install/).

    - **MacOS**:
        Docker Engine is available for macOS through Docker Desktop. Follow the official Docker Desktop [macOS installation guide](https://docs.docker.com/desktop/setup/install/mac-install/).

    - **Windows**:
        Docker Engine is available for Windows through Docker Desktop. Follow the official Docker Desktop [Windows installation guide](https://docs.docker.com/desktop/install/windows-install/).

Refer to the [installation documentation](https://docs.docker.com/engine/install) for your specific operating system. Note that on Windows and Mac, Docker Desktop is required instead of Docker Engine.

2. **Get the image**: You can either pull the pre-built image or build it yourself.

    - **Option 1: Pull the pre-built image (recommended)**:
        ```bash
        docker pull ghcr.io/cse260-fa25/hw3-docker:latest
        ```

    - **Option 2: Build the image yourself**:
        ```bash
        git clone https://github.com/cse260-fa25/hw3-docker.git
        cd hw3-docker
        docker build -t cse260-hw3-docker .
        ```

## Usage
1. **Start a container**: Run the following command to start a Docker container with the CSE260 HW3 environment. Make sure to replace `<path_to_your_hw3_repository>` with the actual path to your local hw3 repository.

```bash
docker run --rm -it --name cse260-hw3-docker -v <path_to_your_hw3_repository>:/home/ubuntu/hw3 ghcr.io/cse260-fa25/hw3-docker:latest bash
```

> [!NOTE]
> If you built the image yourself, replace `ghcr.io/cse260-fa25/hw3-docker:latest` with `cse260-hw3-docker`.

2. **Develop and Test**: The container will start with a bash shell already set up for development. Your repository will be mounted at `/home/ubuntu/hw3` inside the container. You can now compile, debug, and run your MPI programs from this shell as needed. See the homework instructions for specific commands and usage.

> [!TIP]
> You can connect VSCode to the running container for a better development experience. See the [using VSCode](#using-vscode) section below for details.

> [!TIP]
> You can use NCView to visualize NetCDF files generated by your MPI programs. See the [using NCView](#using-ncview) section below for details.

## Using VSCode
To use VSCode with the Docker container, follow these steps:
1. Install the "Remote - Containers" extension in VSCode.
2. Start your Docker container as described in the Usage section.
3. In VSCode, open the Command Palette (Ctrl+Shift+P or Cmd+Shift+P) and select "Remote-Containers: Attach to Running Container...".
4. Choose the container you started for CSE260 HW3.
5. You can now use VSCode to edit files, run terminals, and debug code directly inside the container.

## Using NCView
There are two ways to use NCView to visualize NetCDF files generated by your MPI programs:

- **Option 1: Open NCView on the host machine (recommended)**:
    - Install NCView on your host machine.
        - **Linux**: Use your package manager (e.g., `sudo apt-get install ncview` for Ubuntu).
        - **MacOS**: Use Homebrew (`brew install ncview`).
        - **Windows**: Download and install from [NCView website](https://downloads.unidata.ucar.edu/netcdf/).
    - After running your MPI program inside the Docker container, the generated NetCDF files will be available in your local hw3 repository (mounted volume). You can open these files directly with NCView on your host machine.

2. **Option 2: Run NCView inside the Docker container**:
    - Ensure you have an X server running on your host machine to display graphical applications from the Docker container.
        - **Linux**: You're all set! An X server is already running by default.
        - **MacOS**: Install and run XQuartz.
        > [!IMPORTANT]
        > After installing XQuartz, you may need to allow connections from network clients. Open XQuartz preferences, go to the "Security" tab, and check "Allow connections from network clients". Then restart XQuartz.
        - **Windows**: Install and run VcXsrv.
        > [!IMPORTANT]
        > When going through the VcXsrv setup, ensure that "Disable access control" is checked to allow connections from the Docker container.
    - When starting the Docker container, add the following options to enable X11 forwarding:
        - **Linux**:
            ```bash
            docker run --rm -it \
                --name cse260-hw3-docker \
                -e DISPLAY=$DISPLAY \
                -v /tmp/.X11-unix:/tmp/.X11-unix \
                -e XAUTHORITY=${XAUTHORITY:-$HOME/.Xauthority} \
                -v ${XAUTHORITY:-$HOME/.Xauthority}:${XAUTHORITY:-$HOME/.Xauthority}:ro \
                -v <path_to_your_hw3_repository>:/home/ubuntu/hw3 \
                ghcr.io/cse260-fa25/hw3-docker:latest bash
            ```
        - **MacOS**:
            ```bash
            docker run --rm -it \
                --name cse260-hw3-docker \
                -e DISPLAY=host.docker.internal:0 \
                -v <path_to_your_hw3_repository>:/home/ubuntu/hw3 \
                ghcr.io/cse260-fa25/hw3-docker:latest bash
            ```
        - **Windows**:
            ```bash
            docker run --rm -it \
                --name cse260-hw3-docker \
                -e DISPLAY=host.docker.internal:0.0 \
                -v <path_to_your_hw3_repository>:/home/ubuntu/hw3 \
                ghcr.io/cse260-fa25/hw3-docker:latest bash
            ```
    - Inside the container, after running your MPI program, you can launch NCView to visualize the NetCDF files:
        ```bash
        ncview wave260mpi.nc
        ```